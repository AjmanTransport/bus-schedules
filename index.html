<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ajman Transport — Bus Schedules</title>
  <style>
    :root{--primary:#1f4e79;--bg:#f5f7fb;--card:#fff;--text:#12212f;--muted:#6b7a8a;--border:#e5e9f0;--good:#e8fff0;--warn:#fff6e6;}
    body{margin:0;font-family:system-ui,Segoe UI,Arial;background:var(--bg);color:var(--text);}
    header{background:linear-gradient(90deg,var(--primary),#2b6aa2);color:#fff;padding:18px 16px;}
    header h1{margin:0;font-size:18px;font-weight:800;}
    header .sub{opacity:.9;margin-top:6px;font-size:12px;line-height:1.4}
    .wrap{max-width:1100px;margin:0 auto;padding:14px;}
    .row{display:flex;gap:12px;flex-wrap:wrap;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 2px 10px rgba(16,24,40,.04);}
    .card h2{margin:0 0 10px 0;font-size:14px}
    .routes{display:flex;gap:8px;flex-wrap:wrap}
    .btn{border:1px solid rgba(31,78,121,.25);background:#fff;border-radius:999px;padding:9px 12px;font-weight:700;cursor:pointer;}
    .btn.active{background:rgba(31,78,121,.08);border-color:rgba(31,78,121,.45)}
    .meta{font-size:12px;color:var(--muted)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    select,input{padding:9px 10px;border-radius:10px;border:1px solid var(--border);background:#fff}
    .tablewrap{overflow:auto;border:1px solid var(--border);border-radius:12px}
    table{border-collapse:separate;border-spacing:0;width:100%;min-width:700px}
    thead th{position:sticky;top:0;background:#f8fafc;border-bottom:1px solid var(--border);padding:10px;font-size:12px;text-align:left;z-index:2}
    tbody td{padding:10px;border-bottom:1px solid var(--border);font-size:12px;vertical-align:top}
    tbody tr:hover{background:#f8fbff}
    .chip{display:inline-block;padding:4px 8px;border-radius:999px;background:#eef4ff;border:1px solid #d9e6ff;font-size:11px;font-weight:700}
    .next{background:var(--good)}
    .soon{background:var(--warn)}
    .small{font-size:11px;color:var(--muted)}
    footer{padding:18px 14px;color:var(--muted);font-size:12px;text-align:center}
  </style>
</head>
<body>
<header>
  <h1>Ajman Transport — Bus Trip Schedules</h1>
  <div class="sub">
    Public Transport Department • Business Planning and Development Section<br/>
    Software developed by: Abdelhameed Altoum
  </div>
</header>
<div class="wrap">
  <div class="row">
    <div class="card" style="flex:1;min-width:280px">
      <h2>Select Route</h2>
      <div class="routes" id="routeButtons"></div>
      <div class="meta" id="lastUpdated" style="margin-top:10px"></div>
    </div>
    <div class="card" style="flex:2;min-width:320px">
      <h2>Filters</h2>
      <div class="toolbar">
        <label class="small">Date</label><select id="dateSelect"></select>
        <label class="small">Bus</label><select id="busSelect"><option value="ALL">All</option></select>
        <label class="small">Search time</label><input id="timeSearch" placeholder="e.g. 07:30" style="width:120px"/>
        <span class="small">24h format</span>
      </div>
    </div>
  </div>
  <div class="card" style="margin-top:12px">
    <div class="row" style="align-items:center;justify-content:space-between">
      <h2 id="tableTitle" style="margin:0">Timetable</h2>
      <a class="btn" id="pdfLink" href="schedule.pdf?v=1771146138" style="text-decoration:none">Download PDF (optional)</a>
    </div>
    <div class="tablewrap" style="margin-top:10px">
      <table>
        <thead><tr><th style="width:120px">Bus</th><th>Departures</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
    <div class="small" style="margin-top:10px">Upcoming highlights are based on your phone time. Version: 1771146138</div>
  </div>
</div>
<footer>© Ajman Transport — Bus Schedules</footer>
<script>
let DATA=null; let currentRoute=null;
function toMinutes(t){const [h,m]=t.split(":").map(Number);return h*60+m;}
function nowMinutes(){const d=new Date();return d.getHours()*60+d.getMinutes();}
function markTimes(times){const n=nowMinutes();return times.map(t=>{const diff=toMinutes(t)-n;let cls="";if(diff>=0&&diff<=10)cls="soon";if(diff>=0&&diff<=2)cls="next";return {t,cls};});}
async function load(){const res=await fetch("data/schedules.json?v="+Date.now());DATA=await res.json();
document.getElementById("lastUpdated").textContent="Last updated: "+(DATA.generated_at||"—"); renderRouteButtons();}
function renderRouteButtons(){const box=document.getElementById("routeButtons");box.innerHTML="";
DATA.routes.forEach((r,i)=>{const b=document.createElement("button");b.className="btn"+(i===0?" active":"");b.textContent=r.display_name||r.route;
b.onclick=()=>selectRoute(r.route);box.appendChild(b);});selectRoute(DATA.routes[0].route);}
function selectRoute(routeCode){currentRoute=DATA.routes.find(r=>r.route===routeCode);
document.querySelectorAll("#routeButtons .btn").forEach(btn=>btn.classList.toggle("active",btn.textContent.includes(routeCode)));
const ds=document.getElementById("dateSelect");ds.innerHTML="";currentRoute.days.forEach((d,i)=>{const opt=document.createElement("option");
opt.value=d.date;opt.textContent=d.date+" ("+d.profile+")";ds.appendChild(opt);});
ds.onchange=renderTable;document.getElementById("busSelect").onchange=renderTable;document.getElementById("timeSearch").oninput=renderTable;
document.getElementById("pdfLink").href="schedule.pdf?v="+Date.now(); renderBusDropdown(); renderTable();}
function renderBusDropdown(){const bs=document.getElementById("busSelect");const keep=bs.value||"ALL";bs.innerHTML='<option value="ALL">All</option>';
const date=document.getElementById("dateSelect").value||currentRoute.days[0].date;const day=currentRoute.days.find(x=>x.date===date)||currentRoute.days[0];
day.buses.forEach(b=>{const opt=document.createElement("option");opt.value=b.bus;opt.textContent=b.bus;bs.appendChild(opt);});
if([...bs.options].some(o=>o.value===keep)) bs.value=keep;}
function renderTable(){renderBusDropdown();
const date=document.getElementById("dateSelect").value||currentRoute.days[0].date;
const busFilter=document.getElementById("busSelect").value||"ALL";const timeSearch=(document.getElementById("timeSearch").value||"").trim();
const day=currentRoute.days.find(x=>x.date===date)||currentRoute.days[0];
document.getElementById("tableTitle").textContent=`${currentRoute.display_name||currentRoute.route} — ${day.date} (${day.profile})`;
const tbody=document.getElementById("tbody");tbody.innerHTML="";
day.buses.filter(b=>busFilter==="ALL"?true:b.bus===busFilter).forEach(b=>{let times=b.departures||[];if(timeSearch) times=times.filter(t=>t.includes(timeSearch));
const marked=markTimes(times);const tr=document.createElement("tr");const td1=document.createElement("td");td1.innerHTML=`<span class="chip">${b.bus}</span>`;
const td2=document.createElement("td");td2.innerHTML=marked.map(x=>{const cls=x.cls?` class="${x.cls}"`:"";
return `<span${cls} style="display:inline-block;padding:4px 8px;border-radius:10px;margin:3px;border:1px solid #e6ebf2">${x.t}</span>`;}).join("");
tr.appendChild(td1);tr.appendChild(td2);tbody.appendChild(tr);});}
load();
</script>
</body>
</html>
